image: gitpod/workspace-base

tasks:
  - name: ESP32-C3 Blink Setup
    init: >
      sudo apt-get update &&
      sudo apt-get install -y git wget flex bison gperf python3 cmake ninja-build ccache &&
      git clone -b v4.4.4 --recursive https://github.com/espressif/esp-idf.git &&
      ./esp-idf/install.sh esp32c3 &&
      . ./esp-idf/export.sh &&
      mkdir -p main &&
      echo 'idf_component_register(SRCS "blink.c")' > main/CMakeLists.txt &&
      printf '#include "driver/gpio.h"\n#include "freertos/FreeRTOS.h"\n#include "freertos/task.h"\n\n#define BLINK_GPIO 8\n\nvoid app_main() {\n    gpio_pad_select_gpio(BLINK_GPIO);\n    gpio_set_direction(BLINK_GPIO, GPIO_MODE_OUTPUT);\n    while(1) {\n        gpio_set_level(BLINK_GPIO, 1);\n        vTaskDelay(1000 / portTICK_PERIOD_MS);\n        gpio_set_level(BLINK_GPIO, 0);\n        vTaskDelay(1000 / portTICK_PERIOD_MS);\n    }\n}' > main/blink.c
    command: idf.py set-target esp32c3 && idf.py build
